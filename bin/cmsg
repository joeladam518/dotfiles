#!/usr/bin/env bash

set -Eeo pipefail

# colors
RESET="\033[0m"
BOLD="\033[1m"
BLACK="30"
RED="31"
GREEN="32"
YELLOW="33"
BLUE="34"
MAGENTA="35"
CYAN="36"
GRAY="38;5;239"
WHITE="37"
BRIGHT_BLACK="90"
BRIGHT_RED="91"
BRIGHT_GREEN="92"
BRIGHT_YELLOW="93"
BRIGHT_BLUE="94"
BRIGHT_MAGENTA="95"
BRIGHT_CYAN="96"
BRIGHT_GRAY="38;5;244"
BRIGHT_WHITE="97"

# variables
CMD="echo -e"
COLOR=""
IS_BOLD="0"
NO_NEWLINE="0"
OPTIND=0

# functions
usage() {
    cat <<HERE
Usage: $(basename "$0") [options] {message}

Adds color to your output.

Options:
  -h    Print usage and exit
  -n    no newline
  -d    bold the message
  -r    color the message red
  -R    color the message bright red
  -g    color the message green
  -G    color the message bright green
  -b    color the message blue
  -B    color the message bright blue
  -c    color the message cyan
  -C    color the message bright cyan
  -y    color the message yellow
  -Y    color the message bright yellow
  -m    color the message magenta
  -M    color the message birght magenta
  -w    color the message white
  -W    color the message bright white
  -a    color the message gray
  -A    color the message bright gray
  -k    color the message black
  -K    color the message bright black
HERE
}

invalid_option() {
    echo -e "\033[${RED}mInvalid option -- '-${1}'${RESET}" 1>&2
    exit 1
}

# parse arguments
while getopts ":hndrRgGbBcCyYmMwWaAkK" opt; do
    case "$opt" in
        h) usage; exit                 ;; # print help
        n) NO_NEWLINE="1"              ;; # no new line
        d) IS_BOLD="1"                 ;; # make it bold
        r) COLOR="$RED"                ;;
        R) COLOR="$BRIGHT_RED"         ;;
        g) COLOR="$GREEN"              ;;
        G) COLOR="$BRIGHT_GREEN"       ;;
        b) COLOR="$BLUE"               ;;
        B) COLOR="$BRIGHT_BLUE"        ;;
        c) COLOR="$CYAN"               ;;
        C) COLOR="$BRIGHT_CYAN"        ;;
        y) COLOR="$YELLOW"             ;;
        Y) COLOR="$BRIGHT_YELLOW"      ;;
        m) COLOR="$MAGENTA"            ;;
        M) COLOR="$BRIGHT_MAGENTA"     ;;
        w) COLOR="$WHITE"              ;;
        W) COLOR="$BRIGHT_WHITE"       ;;
        a) COLOR="$GRAY"               ;;
        A) COLOR="$BRIGHT_GRAY"        ;;
        k) COLOR="$BLACK"              ;;
        K) COLOR="$BRIGHT_BLACK"       ;;
        \?) invalid_option "${OPTARG}" ;;
    esac
done

shift $((OPTIND - 1))

# the rest of the arguments are the message to be colored
INPUT="$*"

# add -n flag if no new line
if [ "$NO_NEWLINE" == "1" ]; then
    CMD="${CMD}n"
fi

# output the message in color!
if [ -n "$COLOR" ]; then
    $CMD "\033[${IS_BOLD};${COLOR}m${INPUT}${RESET}"
elif [ "$IS_BOLD" == "1" ]; then
    $CMD "${BOLD}${INPUT}${RESET}"
else
    $CMD "$INPUT"
fi
