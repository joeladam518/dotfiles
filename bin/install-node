#!/usr/bin/env bash

VERSION="${1:-18}"

install_on_debian() {
    local sources_file_path="/etc/apt/sources.list.d/nodesource.list"

    if [ -f "$sources_file_path" ]; then
        sudo rm "$sources_file_path"
        if [ -f "${sources_file_path}.save" ]; then
            sudo rm "${sources_file_path}.save"
        fi
        sudo apt update
    fi

    # https://github.com/nodesource/distributions#debinstall
    curl -sL "https://deb.nodesource.com/setup_${VERSION}.x" | sudo -E bash -
    sudo apt install -y nodejs
}

unsupported_os() {
    echo "Unsupported operating system '$(osinfo)'." 1>&2
    exit 1
}

case "$(osinfo -i)" in
    debian|ubuntu|raspbian) install_on_debian ;;
    *) unsupported_os ;;
esac
